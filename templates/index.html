<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>üçï PizzaVoice AI</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --red:#e63946;--orange:#f4a261;--gold:#ffd60a;
  --bg:#080810;--surface:rgba(255,255,255,.05);
  --border:rgba(255,255,255,.09);--text:#f0f0f0;--muted:#888;
  --radius:18px;
}
html{scroll-behavior:smooth}
body{
  font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);
  min-height:100vh;overflow-x:hidden;
  background-image:
    radial-gradient(ellipse 80% 60% at 50% -10%,rgba(230,57,70,.18) 0%,transparent 70%),
    radial-gradient(ellipse 60% 40% at 80% 110%,rgba(244,162,97,.12) 0%,transparent 70%);
}
.container{max-width:860px;margin:0 auto;padding:0 20px 80px}

/* Header */
header{text-align:center;padding:56px 0 48px}
.logo-ring{
  width:90px;height:90px;border-radius:50%;
  background:linear-gradient(135deg,var(--red),var(--orange));
  display:flex;align-items:center;justify-content:center;font-size:42px;
  margin:0 auto 20px;
  box-shadow:0 0 0 8px rgba(230,57,70,.15),0 0 60px rgba(230,57,70,.4);
  animation:pulse-logo 3s ease-in-out infinite;
}
@keyframes pulse-logo{
  0%,100%{box-shadow:0 0 0 8px rgba(230,57,70,.15),0 0 60px rgba(230,57,70,.4)}
  50%{box-shadow:0 0 0 16px rgba(230,57,70,.08),0 0 80px rgba(230,57,70,.6)}
}
h1{
  font-family:'Space Grotesk',sans-serif;font-size:clamp(2rem,5vw,3rem);font-weight:700;
  background:linear-gradient(135deg,#fff 30%,var(--orange));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.tagline{color:var(--muted);font-size:1rem;margin-top:8px}

/* Engine badge */
.engine-badge{
  display:inline-flex;align-items:center;gap:6px;
  background:rgba(255,255,255,.06);border:1px solid var(--border);
  border-radius:50px;padding:6px 14px;font-size:.78rem;color:var(--muted);
  margin-top:12px;
}
.engine-badge.ai{background:rgba(230,57,70,.12);border-color:rgba(230,57,70,.3);color:var(--orange)}

/* Step label */
.step-label{
  display:flex;align-items:center;gap:10px;font-size:.75rem;font-weight:700;
  letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:14px;
}
.step-label span{
  width:22px;height:22px;border-radius:50%;
  background:linear-gradient(135deg,var(--red),var(--orange));
  display:flex;align-items:center;justify-content:center;font-size:.7rem;
  font-weight:800;color:#fff;flex-shrink:0;
}

/* Card */
.card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:28px;backdrop-filter:blur(12px);
  margin-bottom:20px;transition:border-color .3s;
}
.card:hover{border-color:rgba(230,57,70,.3)}

/* Mic */
.mic-area{text-align:center;padding:8px 0 24px}
.mic-wrapper{position:relative;display:inline-flex;align-items:center;justify-content:center;margin-bottom:28px}
.ring{position:absolute;width:120px;height:120px;border-radius:50%;border:2px solid var(--red);opacity:0}
.recording .ring{animation:ripple 1.6s ease-out infinite}
.ring-1{animation-delay:0s}.ring-2{animation-delay:.4s}.ring-3{animation-delay:.8s}
@keyframes ripple{0%{transform:scale(1);opacity:.7}100%{transform:scale(2.8);opacity:0}}
#mic-btn{
  width:90px;height:90px;border-radius:50%;border:none;cursor:pointer;
  background:linear-gradient(145deg,var(--red),#c1121f);color:#fff;font-size:32px;
  position:relative;z-index:2;box-shadow:0 8px 32px rgba(230,57,70,.5);
  transition:transform .2s,box-shadow .2s;
}
#mic-btn:hover{transform:scale(1.08);box-shadow:0 12px 40px rgba(230,57,70,.7)}
#mic-btn.active{animation:mic-pulse .8s ease-in-out infinite}
@keyframes mic-pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}

/* Waveform */
.waveform{display:flex;align-items:center;justify-content:center;gap:4px;height:48px;margin-bottom:20px}
.bar{width:4px;border-radius:4px;background:linear-gradient(to top,var(--red),var(--orange));height:8px;transition:height .15s}
.recording .bar:nth-child(odd){animation:wave-a .6s ease-in-out infinite alternate}
.recording .bar:nth-child(even){animation:wave-b .6s ease-in-out infinite alternate}
@keyframes wave-a{to{height:42px}}
@keyframes wave-b{to{height:28px}}
#status-text{color:var(--muted);font-size:.9rem;min-height:22px}
#status-text.active{color:var(--red);font-weight:600}

/* Transcript */
#transcript-box{
  background:rgba(0,0,0,.4);border:1px solid var(--border);border-radius:12px;
  padding:16px 20px;min-height:80px;font-size:.95rem;line-height:1.7;color:#d0d0d0;
  margin-bottom:16px;transition:border-color .3s;
}
#transcript-box.has-text{border-color:rgba(230,57,70,.3)}
.placeholder{color:var(--muted);font-style:italic}

/* Text input */
#text-input{
  width:100%;background:rgba(0,0,0,.4);border:1px solid var(--border);
  border-radius:12px;padding:14px 18px;font-size:.95rem;color:var(--text);
  font-family:inherit;resize:vertical;min-height:80px;outline:none;
  transition:border-color .3s;
}
#text-input:focus{border-color:rgba(230,57,70,.5)}
#text-input::placeholder{color:var(--muted);font-style:italic}

/* Suggestion chips */
.chips{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0 4px}
.chip{
  background:rgba(255,255,255,.05);border:1px solid var(--border);
  border-radius:50px;padding:6px 14px;font-size:.78rem;cursor:pointer;
  color:var(--muted);transition:all .2s;
}
.chip:hover{border-color:rgba(230,57,70,.4);color:var(--text);background:rgba(230,57,70,.08)}

/* Buttons */
.btn{
  display:inline-flex;align-items:center;gap:8px;padding:13px 28px;
  border-radius:50px;font-weight:700;font-size:.9rem;cursor:pointer;
  border:none;transition:all .2s;letter-spacing:.03em;
}
.btn-primary{background:linear-gradient(135deg,var(--red),var(--orange));color:#fff;box-shadow:0 6px 24px rgba(230,57,70,.4)}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 32px rgba(230,57,70,.55)}
.btn-primary:disabled{opacity:.5;pointer-events:none}
.btn-secondary{background:rgba(255,255,255,.08);color:var(--text);border:1px solid var(--border)}
.btn-secondary:hover{background:rgba(255,255,255,.14)}
.btn-ghost{background:transparent;color:var(--muted);border:1px dashed var(--border);font-size:.82rem;padding:9px 18px}
.btn-ghost:hover{border-color:var(--red);color:var(--red)}
.btn-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}

/* Browser notice */
#browser-notice{
  background:rgba(255,214,10,.08);border:1px solid rgba(255,214,10,.25);
  border-radius:10px;padding:12px 16px;font-size:.83rem;color:var(--gold);
  margin-bottom:16px;display:none;
}

/* Result */
#result-section{display:none;animation:slide-up .5s ease}
@keyframes slide-up{from{opacity:0;transform:translateY(32px)}to{opacity:1;transform:translateY(0)}}

/* Spec grid */
.spec-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:20px}
.spec-card{
  background:rgba(0,0,0,.35);border:1px solid var(--border);border-radius:14px;
  padding:16px 18px;transition:border-color .3s;
}
.spec-card:hover{border-color:rgba(244,162,97,.3)}
.spec-card-label{font-size:.68rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:6px}
.spec-card-emoji{font-size:1.4rem;margin-bottom:4px;display:block}
.spec-card-value{font-size:1rem;font-weight:700;color:var(--text)}
.spec-card-price{font-size:.8rem;color:var(--orange);margin-top:2px}

/* Topping pills */
.toppings-grid{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px}
.topping-pill{
  display:inline-flex;align-items:center;gap:6px;
  background:rgba(230,57,70,.12);border:1px solid rgba(230,57,70,.25);
  border-radius:50px;padding:7px 14px;font-size:.85rem;
}
.topping-pill .t-price{color:var(--orange);font-weight:600;font-size:.78rem}

/* Receipt */
.receipt-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px}
.receipt-title{font-family:'Space Grotesk',sans-serif;font-size:1.2rem;font-weight:700}
.order-meta{text-align:right}
.order-id{font-family:'Space Grotesk',sans-serif;font-size:1.1rem;font-weight:700;color:var(--gold);letter-spacing:.06em}
.order-ts{font-size:.75rem;color:var(--muted);margin-top:3px}

.receipt-table{width:100%;border-collapse:collapse;font-size:.9rem}
.receipt-table th{padding:10px 14px;text-align:left;font-size:.72rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);border-bottom:1px solid var(--border)}
.receipt-table th:last-child{text-align:right}
.receipt-table td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.04);vertical-align:middle}
.receipt-table td:last-child{text-align:right;font-weight:600;color:var(--orange)}
.receipt-table tr:hover td{background:rgba(255,255,255,.02)}
.row-section td{font-weight:700;font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);padding:8px 14px;border-bottom:none;background:rgba(255,255,255,.02)}
.divider{border:none;border-top:1px solid var(--border);margin:4px 0}
.total-row td{padding:16px 14px 8px;font-weight:800;font-size:1.05rem;color:var(--text);border-bottom:none}
.total-row td:last-child{color:var(--gold);font-size:1.2rem}
.tax-row td{color:var(--muted);font-size:.82rem;border-bottom:none;padding:4px 14px 14px}
.tax-row td:last-child{color:var(--muted)}
.emoji-cell{font-size:1.2rem;padding-right:6px}
.qty-badge{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;background:var(--red);color:#fff;font-size:.72rem;font-weight:800;margin-right:6px}

/* Action bar */
.action-bar{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;margin-top:24px;padding-top:20px;border-top:1px solid var(--border)}
.action-bar-total{font-size:.85rem;color:var(--muted)}
.action-bar-total strong{color:var(--gold);font-size:1.1rem}

/* Loading spinner */
.spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;display:inline-block}
@keyframes spin{to{transform:rotate(360deg)}}

footer{text-align:center;color:var(--muted);font-size:.78rem;padding:28px 0 0}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:4px}
@media(max-width:560px){.receipt-header{flex-direction:column;gap:12px}.order-meta{text-align:left}.spec-grid{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo-ring">üçï</div>
    <h1>PizzaVoice AI</h1>
    <p class="tagline">Speak your perfect pizza ‚Äî powered by free HuggingFace AI ‚ú®</p>
  </header>

  <!-- Step 1 -->
  <div class="step-label"><span>1</span>Describe your pizza</div>
  <div class="card">
    <div id="browser-notice">‚ö†Ô∏è Voice input works best in Chrome or Edge. Use the text box below for other browsers.</div>

    <div class="mic-area" id="mic-area">
      <div class="mic-wrapper" id="mic-wrapper">
        <div class="ring ring-1"></div><div class="ring ring-2"></div><div class="ring ring-3"></div>
        <button id="mic-btn" title="Tap to speak">üéôÔ∏è</button>
      </div>
      <div class="waveform" id="waveform"></div>
      <p id="status-text">Tap the mic and describe your pizza!</p>
    </div>

    <div id="transcript-box"><span class="placeholder">Your spoken order will appear here‚Ä¶</span></div>

    <textarea id="text-input" rows="3"
      placeholder="Or type your order, e.g.: I'd like a large stuffed crust BBQ chicken pizza with bacon, jalape√±os and extra cheese‚Ä¶"></textarea>

    <!-- Quick suggestion chips -->
    <div class="chips" id="chips">
      <span class="chip" onclick="fillChip(this)">üçï Large pepperoni with stuffed crust</span>
      <span class="chip" onclick="fillChip(this)">ü•ó Medium veggie with pesto and feta</span>
      <span class="chip" onclick="fillChip(this)">üçó Large BBQ chicken with bacon and jalape√±os</span>
      <span class="chip" onclick="fillChip(this)">üå± Cauliflower crust with avocado and spinach</span>
      <span class="chip" onclick="fillChip(this)">üçç Two large hawaiian with extra cheese</span>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" id="build-btn">‚ú® Build My Pizza</button>
      <button class="btn btn-ghost" id="clear-btn">‚úï Clear</button>
    </div>
  </div>

  <!-- Step 2 Result -->
  <div id="result-section">
    <div class="step-label"><span>2</span>Your pizza breakdown</div>
    <div class="spec-grid" id="spec-grid"></div>

    <div class="card" id="toppings-card" style="display:none">
      <div class="step-label" style="margin-bottom:10px"><span>üçÑ</span>Toppings &amp; Extras</div>
      <div class="toppings-grid" id="toppings-grid"></div>
    </div>

    <div class="step-label"><span>3</span>Order receipt</div>
    <div class="card">
      <div class="receipt-header">
        <div>
          <div class="receipt-title">üßæ Order Summary</div>
          <div id="engine-display" class="engine-badge" style="margin-top:8px"></div>
        </div>
        <div class="order-meta">
          <div class="order-id" id="order-id-display">‚Äî</div>
          <div class="order-ts" id="order-ts-display">‚Äî</div>
        </div>
      </div>

      <table class="receipt-table">
        <thead>
          <tr>
            <th colspan="2">Item</th>
            <th>Unit</th>
            <th>Qty</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="receipt-body"></tbody>
      </table>

      <div class="action-bar">
        <div class="action-bar-total">Total: <strong id="grand-total-label">$0.00</strong></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print</button>
          <button class="btn btn-primary" id="new-order-btn">üçï New Order</button>
        </div>
      </div>
    </div>
  </div>
</div>

<footer>PizzaVoice AI ¬∑ HuggingFace Free Inference API ¬∑ Educational purposes only</footer>

<script>
// ‚îÄ‚îÄ Waveform bars ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const wf=document.getElementById('waveform');
for(let i=0;i<14;i++){const b=document.createElement('div');b.className='bar';wf.appendChild(b)}

// ‚îÄ‚îÄ Web Speech API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
let recog=null,isRec=false,finalText='';
if(!SR){document.getElementById('browser-notice').style.display='block'}
else{
  recog=new SR();recog.continuous=true;recog.interimResults=true;recog.lang='en-US';
  recog.onresult=e=>{
    let interim='',final='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      if(e.results[i].isFinal)final+=e.results[i][0].transcript+' ';
      else interim+=e.results[i][0].transcript;
    }
    if(final)finalText+=final;
    const box=document.getElementById('transcript-box'),full=finalText+interim;
    box.classList.toggle('has-text',!!full.trim());
    box.innerHTML=full.trim()?escHtml(full):'<span class="placeholder">Your spoken order will appear here‚Ä¶</span>';
    if(full.trim())syncTA(full);
  };
  recog.onerror=e=>{if(e.error!=='no-speech')setStatus('Mic error: '+e.error,false);stopRec()};
  recog.onend=()=>{if(isRec)stopRec()};
}

function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function syncTA(t){const ta=document.getElementById('text-input');if(!ta.dataset.manual)ta.value=t.trim()}
document.getElementById('text-input').addEventListener('input',function(){
  this.dataset.manual='1';finalText=this.value;
  const box=document.getElementById('transcript-box');
  box.classList.toggle('has-text',!!this.value.trim());
  box.innerHTML=this.value.trim()?escHtml(this.value):'<span class="placeholder">Your spoken order will appear here‚Ä¶</span>';
});

function setStatus(msg,active){const el=document.getElementById('status-text');el.textContent=msg;el.className=active?'active':''}
function startRec(){
  if(!recog)return;isRec=true;
  finalText=document.getElementById('text-input').value||'';
  document.getElementById('mic-btn').classList.add('active');
  document.getElementById('mic-btn').textContent='‚èπÔ∏è';
  document.getElementById('mic-wrapper').classList.add('recording');
  document.getElementById('mic-area').classList.add('recording');
  setStatus('üî¥ Listening‚Ä¶',true);
  try{recog.start()}catch(e){}
}
function stopRec(){
  isRec=false;if(recog){try{recog.stop()}catch(e){}}
  document.getElementById('mic-btn').classList.remove('active');
  document.getElementById('mic-btn').textContent='üéôÔ∏è';
  document.getElementById('mic-wrapper').classList.remove('recording');
  document.getElementById('mic-area').classList.remove('recording');
  const t=(finalText+(document.getElementById('text-input').value||'')).trim();
  setStatus(t?'‚úÖ Got it! Hit "Build My Pizza".':'Tap the mic and describe your pizza!',false);
}
document.getElementById('mic-btn').addEventListener('click',()=>{
  if(!recog){document.getElementById('text-input').focus();return}
  isRec?stopRec():startRec();
});

// ‚îÄ‚îÄ Chips ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fillChip(el){
  const txt=el.textContent.replace(/^[^\w]+/,'');
  document.getElementById('text-input').value=txt;
  document.getElementById('text-input').dataset.manual='1';
  finalText=txt;
  const box=document.getElementById('transcript-box');
  box.textContent=txt;box.classList.add('has-text');
  setStatus('‚úÖ Ready! Hit "Build My Pizza".',false);
}

// ‚îÄ‚îÄ Clear ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('clear-btn').addEventListener('click',()=>{
  finalText='';
  const ta=document.getElementById('text-input');ta.value='';delete ta.dataset.manual;
  const box=document.getElementById('transcript-box');
  box.innerHTML='<span class="placeholder">Your spoken order will appear here‚Ä¶</span>';
  box.classList.remove('has-text');
  setStatus('Tap the mic and describe your pizza!',false);
  document.getElementById('result-section').style.display='none';
});
document.getElementById('new-order-btn').addEventListener('click',()=>{
  document.getElementById('clear-btn').click();
  window.scrollTo({top:0,behavior:'smooth'});
});

// ‚îÄ‚îÄ Build ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('build-btn').addEventListener('click',async()=>{
  const text=(document.getElementById('text-input').value||finalText).trim();
  if(!text){alert('Please speak or type your pizza order first! üéôÔ∏è');return}
  const btn=document.getElementById('build-btn');
  btn.innerHTML='<span class="spinner"></span> Crafting‚Ä¶';btn.disabled=true;
  try{
    const res=await fetch('/parse',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})});
    const data=await res.json();
    if(data.error){alert(data.error);return}
    renderResult(data);
  }catch(e){alert('Network error ‚Äî is the server running?')}
  finally{btn.innerHTML='‚ú® Build My Pizza';btn.disabled=false}
});

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fmt=n=>'$'+n.toFixed(2);

function renderResult({order,pricing,engine,order_id,timestamp}){
  // Spec cards
  const specs=[
    {label:'Size',   emoji:'üìè',value:order.size.label,   price:order.size.price},
    {label:'Crust',  emoji:'ü•®',value:order.crust.label,  price:order.crust.price},
    {label:'Sauce',  emoji:'ü•´',value:order.sauce.label,  price:order.sauce.price?'+'+fmt(order.sauce.price):'Included'},
    {label:'Cheese', emoji:'üßÄ',value:order.cheese.label, price:order.cheese.price?'+'+fmt(order.cheese.price):'Included'},
    {label:'Qty',    emoji:'üî¢',value:order.quantity+' Pizza'+(order.quantity>1?'s':''),price:null},
    {label:'Total',  emoji:'üí∞',value:fmt(pricing.total), price:null},
  ];
  document.getElementById('spec-grid').innerHTML=specs.map(s=>`
    <div class="spec-card">
      <div class="spec-card-label">${s.label}</div>
      <span class="spec-card-emoji">${s.emoji}</span>
      <div class="spec-card-value">${s.value}</div>
      ${s.price!==null?`<div class="spec-card-price">${typeof s.price==='number'?fmt(s.price):s.price}</div>`:''}
    </div>`).join('');

  // Toppings
  const all=[...order.toppings,...order.extras];
  const tc=document.getElementById('toppings-card');
  if(all.length){
    tc.style.display='block';
    document.getElementById('toppings-grid').innerHTML=all.map(t=>`
      <div class="topping-pill">${t.emoji||'‚≠ê'} ${t.label}<span class="t-price">+${fmt(t.price)}</span></div>`).join('');
  } else tc.style.display='none';

  // Engine badge
  const eb=document.getElementById('engine-display');
  eb.textContent=engine;
  eb.className='engine-badge'+(engine.includes('AI')?' ai':'');

  // Meta
  document.getElementById('order-id-display').textContent='#'+order_id;
  document.getElementById('order-ts-display').textContent=timestamp;

  // Receipt
  const bd=pricing.breakdown,q=pricing.quantity,rows=[];
  rows.push(`<tr class="row-section"><td colspan="5">üçï Base</td></tr>`);
  rows.push(row('üìè','Size ‚Äî '+order.size.label,bd.base,q,bd.base*q));
  if(bd.crust) rows.push(row('ü•®','Crust ‚Äî '+order.crust.label,bd.crust,q,bd.crust*q));
  if(bd.sauce) rows.push(row('ü•´','Sauce ‚Äî '+order.sauce.label,bd.sauce,q,bd.sauce*q));
  if(bd.cheese)rows.push(row('üßÄ','Cheese ‚Äî '+order.cheese.label,bd.cheese,q,bd.cheese*q));
  if(order.toppings.length){
    rows.push(`<tr class="row-section"><td colspan="5">üçÑ Toppings</td></tr>`);
    order.toppings.forEach(t=>rows.push(row(t.emoji||'üçï',t.label,t.price,q,t.price*q)));
  }
  if(order.extras.length){
    rows.push(`<tr class="row-section"><td colspan="5">‚≠ê Extras</td></tr>`);
    order.extras.forEach(e=>rows.push(row('‚≠ê',e.label,e.price,q,e.price*q)));
  }
  rows.push(`<tr><td colspan="5"><hr class="divider"/></td></tr>`);
  rows.push(`<tr>
    <td colspan="2" style="color:var(--muted);font-size:.85rem">Unit √ó ${q}</td>
    <td style="text-align:right;color:var(--muted)">${fmt(pricing.unit)}</td>
    <td style="text-align:center;color:var(--muted)">√ó${q}</td>
    <td style="text-align:right;font-weight:700;color:var(--orange)">${fmt(pricing.subtotal)}</td>
  </tr>`);
  rows.push(`<tr class="tax-row"><td colspan="4">HST / Tax (13%)</td><td>${fmt(pricing.tax)}</td></tr>`);
  rows.push(`<tr class="total-row"><td colspan="4">üéâ Grand Total</td><td>${fmt(pricing.total)}</td></tr>`);
  document.getElementById('receipt-body').innerHTML=rows.join('');
  document.getElementById('grand-total-label').textContent=fmt(pricing.total);

  document.getElementById('result-section').style.display='block';
  setTimeout(()=>document.getElementById('result-section').scrollIntoView({behavior:'smooth',block:'start'}),100);
}

function row(emoji,label,unit,qty,amount){
  return `<tr>
    <td class="emoji-cell">${emoji}</td><td>${label}</td>
    <td style="text-align:right;color:var(--muted)">${fmt(unit)}</td>
    <td style="text-align:center"><span class="qty-badge">${qty}</span></td>
    <td>${fmt(amount)}</td>
  </tr>`;
}
</script>
</body>
</html>